# 目录
[平台三方设备对接协议规范	2****](#_toc31938)**

[一、websocket接口	2](#_toc17027)

[1.1 连接服务器	2](#_toc21656)

[1.2 更新Token	4](#_toc190)

[1.3 设备心跳	5](#_toc28616)

[1.5 人脸参数控制	8](#_toc3771)

[1.6 录像设置	10](#_toc27476)

[1.7 按月获取每天的视频文件数量	12](#_toc9800)

[1.8 按月获取每天的视频文件数量	13](#_toc28195)

[1.9 重启设备	15](#_toc11168)

[1.10 查询抓拍图像的文件列表	16](#_toc30318)

[1.11 查询行人抓拍图像的文件列表	19](#_toc1248)

[1.12 下发人员信息及照片	21](#_toc25316)

[1.13 查询人员列表	22](#_toc27388)

[1.14 查询人员信息	25](#_toc29116)

[1.15 删除人员信息	27](#_toc12307)

[1.16 以图搜图	28](#_toc11833)

[二、HTTP接口	30](#_toc13688)

[2.1 上传人脸抓拍图像	30](#_toc21265)

[2.2 上报设备信息(设备上电时调用)	31](#_toc30454)

[2.3 查询在线升级版本信息	32](#_toc4397)

[2.4 上报告警信息	34](#_toc32008)

[2.5 上报车辆抓拍信息	35](#_toc25958)

[三、签名算法	38](#_toc22059)

[四、错误码	39](#_toc15658)

[**附录	40****](#_toc30584)




# <a name="_toc31938"></a>**平台三方设备对接协议规范**
设备管理系统是运行在服务器上的Web管理平台，提供了HTTP(s)和WebSocket(Secure)形式的接口。其中，HTTP(s)接口提供了设备向服务器请求及上传数据的单向通道；WebSocket提供了双向连接的通道，可用于服务器向设备下发数据。

## <a name="_toc17027"></a>**一、websocket接口**
设备端通过WebSocket(Secure)与服务器进行通信。生产环境与测试环境均使用wss连接方式，在传输层进行数据加密。
### <a name="连接服务器"></a><a name="_toc21656"></a>**1.1 连接服务器**
设备连接服务器

{

"msgid": "adfdgwrt245356",

"data": {

"uri"："/connect",

"param": {

"did"：<a name="_hlk120786907"></a>"1234512",

"sn"："Y3C122AP1234512",

"ip"："192.168.100.168",

"sign": "567yuisfghg435646hgf56768",

"ts": 1635066908

}

}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th colspan="1" valign="top">类型</th><th colspan="1" valign="top">说明</th><th colspan="1" valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">消息ID，由设备生成，每条消息对应一个唯一的ID</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" rowspan="7" valign="top"></td><td colspan="2" valign="top">uri</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">固定为"/connect"</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">param</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" rowspan="5" valign="top"></td><td colspan="1" valign="top">did</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">一般为整数形式的字符串，最大不超过2<sup>64</sup>。</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="1" valign="top">sn</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">设备系列号</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">ip</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">设备的局域网IP地址</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">sign</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">设备端签名,用以校验设备的合法性，详见下文说明</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">ts</td><td colspan="1" valign="top">整数</td><td colspan="1" valign="top">UNIX时间戳，单位：秒</td><td colspan="1" valign="top">是</td></tr>
</table>


签名字段(sign)计算方法：Base64 { RSA [ MD5(设备SN + 设备安全码 + 时间戳) ] }。

即先将15位设备序列号、8位安全码和当前的时间戳拼接组成字符串，并计算该字符串的MD5值，再用设备私钥进行签名，最后转换成Base64编码字符串。

设备ID字段(did)默认为空，在用户添加设备时由平台分配并下发至设备保存。设备恢复出厂设置后，设备上保存的did参数应当清除。如果did为空，此接口将返回421错误。

响应

{

`	`"msgid": "adfdgwrt245356",

`	`"data": {

"uri"："/connect",

"code": 200,

"msg": "OK",

"result": {

`        	`"token": "adf4453456ghhjgsf23546y",

`        	`"expire": 3600,

"interval"：30

}

`	`}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th colspan="1" valign="top">类型</th><th colspan="1" valign="top">说明</th><th colspan="1" valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">消息ID，与命令中的参数一致。</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" rowspan="7" valign="top"></td><td colspan="2" valign="top">uri</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">固定为"/connect"</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="2" valign="top">code</td><td colspan="1" valign="top">整数</td><td colspan="1" valign="top">错误码，详见错误码定义。</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">msg</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">执行结果描述。</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="2" valign="top">result</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top">执行成功后返回的数据，失败时该字段为空。</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="1" rowspan="3" valign="top"></td><td colspan="1" valign="top">token</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">由服务器生成，不超过32字节。该字段将用于其它WebSocket和HTTP接口身份认证。</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">expire</td><td colspan="1" valign="top">整数</td><td colspan="1" valign="top">表示该token的有效时间(秒)，设备需要在有效期内更新token，否则就需要重新连接。token的有效期一般为30分钟到2小时之间。</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">interval</td><td colspan="1" valign="top">整数</td><td colspan="1" valign="top">设备心跳频率，即设备向平台发送心跳命令的最大间隔时间，单位：秒。</td><td colspan="1" valign="top">是</td></tr>
</table>


通常情况下，设备上电启动后，应当首先调用该接口向平台获取有效的token，然后才能调用其它接口。如果返回421错误，说明该设备尚未向平台注册，或者设备被恢复了出厂设置。此时设备应等待平台下发初始化参数后再调用该接口连接平台。
### <a name="_toc190"></a>**1.2 更新Token**
设备上报心跳到服务器

{

"msgid": "adfdgwrt245356",

"token"："adf4453456ghhjgsf23546y",

"data": {

"uri"："/token/update",

"param": {

"did"："1234512",

"sn"："Y3C122AP1234512"

}

}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th colspan="1" valign="top">类型</th><th colspan="1" valign="top">说明</th><th colspan="1" valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">消息ID，由设备生成，每条消息对应一个唯一的ID</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="3" valign="top">token</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">会话token，设备[connect](#连接服务器)服务器时，由服务器返回</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" rowspan="4" valign="top"></td><td colspan="2" valign="top">uri</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">固定为"/token/update"</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">param</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" rowspan="2" valign="top"></td><td colspan="1" valign="top">did</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">sn</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">设备系列号</td><td colspan="1" valign="top">是</td></tr>
</table>


响应

{

`	`"msgid": "adfdgwrt245356",

"data": {

"uri"："/token/update",

"code": 200,

"msg": "OK",

"result": {

`        	`"token": "adf4453456ghhjgsf23546y",

`        	`"expire": 3600

}

`	`}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th colspan="1" valign="top">类型</th><th colspan="1" valign="top">说明</th><th colspan="1" valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">消息ID，与命令中的参数一致。</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" rowspan="6" valign="top"></td><td colspan="2" valign="top">uri</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">固定为"/connect"</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="2" valign="top">code</td><td colspan="1" valign="top">整数</td><td colspan="1" valign="top">错误码，详见错误码定义。</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">msg</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">执行结果描述。</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="2" valign="top">result</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top">执行成功后返回的数据，失败时该字段为空。</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="1" rowspan="2" valign="top"></td><td colspan="1" valign="top">token</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">由服务器生成，不超过32字节。该字段将用于其它WebSocket和HTTP接口身份认证。</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">expire</td><td colspan="1" valign="top">整数</td><td colspan="1" valign="top">表示该token的有效时间(秒)，设备需要在有效期内更新token，否则就需要重新连接。token的有效期一般为30分钟到2小时之间。</td><td colspan="1" valign="top">是</td></tr>
</table>


### <a name="_toc28616"></a>**1.3 设备心跳**
设备上报心跳到服务器

{

"msgid ": "adfdgwrt245356",

"token"："adf4453456ghhjgsf23546y",

"data": {

"uri"："/heartbeat",

"param": {

"did"："1234512",

"sn"："Y3C122AP1234512",

"ip"："192.168.100.168"

}

}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th colspan="1" valign="top">类型</th><th colspan="1" valign="top">说明</th><th colspan="1" valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">消息ID，由设备生成，每条消息对应一个唯一的ID</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="3" valign="top">token</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">会话token，设备[connect](#连接服务器)服务器时，由服务器返回</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" rowspan="5" valign="top"></td><td colspan="2" valign="top">uri</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">固定为"/heartbeat"</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">param</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" rowspan="3" valign="top"></td><td colspan="1" valign="top">did</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">sn</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">设备系列号</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">ip</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">设备的局域网IP地址</td><td colspan="1" valign="top">是</td></tr>
</table>


响应

{

"msgid": "adfdgwrt245356",

"data": {

"uri"："/heartbeat",

"code": 200,

"msg": "OK",

"result": {

`        	`"expire": 3599

}

`	`}

}

<table><tr><th colspan="3" valign="top">参数</th><th colspan="1" valign="top">类型</th><th colspan="1" valign="top">说明</th><th colspan="1" valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">消息ID，与命令中的参数一致。</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" rowspan="5" valign="top"></td><td colspan="2" valign="top">uri</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">固定为"/heartbeat"</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="2" valign="top">code</td><td colspan="1" valign="top">整数</td><td colspan="1" valign="top">错误码，详见错误码定义。</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">msg</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">执行结果描述。</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="2" valign="top">result</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top">执行成功后返回的数据，失败时该字段为空。</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="1" valign="top"></td><td colspan="1" valign="top">expire</td><td colspan="1" valign="top">整数</td><td colspan="1" valign="top">表示该token的有效时间(秒)。</td><td colspan="1" valign="top">是</td></tr>
</table>


为确保设备时刻在线，设备需要在心跳间隔时间(由[connect](#连接服务器)命令获得的interval参数)内循环发送心跳命令。expire 表示该token的剩余有效时间。

### <a name="_toc3771"></a>**1.5 人脸参数控制**
服务器控制人脸参数，

{

"msgid": "adfdgwrt245356",

"token"："adf4453456ghhjgsf23546y",

"data": {

"uri"："/ivp/person\_param\_set",

"param": {

"enable" : true,

"show\_face" : true,

"show\_human" : true,

"push\_stranger" : true,

"push\_face" : true,

"push\_bg" : true,

"play\_audio" :false,

"play\_audio\_stranger":true,

"play\_audio\_white":true,

"play\_audio\_black":true,

"play\_audio\_vip":true,

"play\_audio\_friend":true,

"threshold" : 50,

"reg\_threshold":85,

"mini\_face": 50,

"mini\_human":50,

"quality\_face":50,

"quality\_human":50,

"server\_enable":true,

"alarm\_out":{

"interval":10

`		`"alarm\_push":true

}

}

}

}

参数说明：

<table><tr><th colspan="4" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="4" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，由设备生成，每条消息对应一个唯一的ID</td><td valign="top">是</td></tr>
<tr><td colspan="4" valign="top">token</td><td valign="top">字符串</td><td valign="top">会话token，设备[connect](#连接服务器)服务器时，由服务器返回</td><td valign="top">是</td></tr>
<tr><td colspan="4" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="24" valign="top"></td><td colspan="3" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"ivp/facecap_param_set"</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">param</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="22" valign="top"></td><td colspan="2" valign="top">enable</td><td valign="top">布尔</td><td valign="top">1打开 0关闭</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">show_face</td><td valign="top">布尔</td><td valign="top">显示人脸框</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">show_human</td><td valign="top">布尔</td><td valign="top">显示人形框</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">push_stranger</td><td valign="top">布尔</td><td valign="top">推送陌生人</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">push_face</td><td valign="top">布尔</td><td valign="top">推送人脸图</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">push_bg</td><td valign="top">布尔</td><td valign="top">推送背景图</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">play_audio</td><td valign="top">布尔</td><td valign="top">语音播报</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">play_audio_stranger</td><td valign="top">布尔</td><td valign="top">陌生人语音播报</td><td valign="top">否</td></tr>
<tr><td colspan="2" valign="top">play_audio_white</td><td valign="top">布尔</td><td valign="top">白名单语音播报</td><td valign="top">否</td></tr>
<tr><td colspan="2" valign="top">play_audio_black</td><td valign="top">布尔</td><td valign="top">黑名单语音播报</td><td valign="top">否</td></tr>
<tr>i<td colspan="2" valign="top">play_audio_vip</td><td valign="top">布尔</td><td valign="top">VIP语音播报</td><td valign="top">否</td></tr>
<tr><td colspan="2" valign="top">play_audio_friend</td><td valign="top">布尔</td><td valign="top">访客语音播报</td><td valign="top">否</td></tr>
<tr><td colspan="2" valign="top">threshold</td><td valign="top">整型</td><td valign="top">检测阈值 0-100</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">reg_threshold</td><td valign="top">整型</td><td valign="top">识别阈值 0-100</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">mini_face</td><td valign="top">整型</td><td valign="top">人脸大小 30-500</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">mini_human</td><td valign="top">整型</td><td valign="top">人体大小 60-1000</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">quality_face</td><td valign="top">整型</td><td valign="top">人脸质量 0-100</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">quality_human</td><td valign="top">整型</td><td valign="top">人体质量 0 -100</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">server_enable</td><td valign="top">布尔</td><td valign="top">使能人脸服务器</td><td valign="top"></td></tr>
<tr><td colspan="2" valign="top">alarm_out</td><td valign="top">对象</td><td valign="top">人脸报警 10-60s</td><td valign="top">是</td></tr>
<tr><td rowspan="2" valign="top"></td><td valign="top">interval</td><td valign="top">整型</td><td valign="top">报警间隔</td><td valign="top">是</td></tr>
<tr><td valign="top">alarm_push</td><td valign="top">布尔</td><td valign="top">服务器推送</td><td valign="top">是</td></tr>
</table>


响应

{

"msgid": "adfdgwrt245356",

"data": {

"uri"：" /ivp/facecap\_param\_set",

"code": 200,

"msg": "OK"

`	`}

}

参数说明：

<table><tr><th colspan="2" valign="top">参数</th><th colspan="1" valign="top">类型</th><th colspan="1" valign="top">说明</th><th colspan="1" valign="top">是否必须</th></tr>
<tr><td colspan="2" valign="top">msgid</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">消息ID，与命令中的参数一致。</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">data</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" rowspan="3" valign="top"></td><td colspan="1" valign="top">uri</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">固定为"ivp/facecap_param_set"</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="1" valign="top">code</td><td colspan="1" valign="top">整型</td><td colspan="1" valign="top">错误码，详见错误码定义。</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">msg</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">执行结果描述。</td><td colspan="1" valign="top">否</td></tr>
</table>



### <a name="_toc27476"></a>**1.6 录像设置**
服务器设置录像参数，

{

"msgid": "adfdgwrt245356",

"token"："adf4453456ghhjgsf23546y",

"data": {

"uri"："/storage/record\_set",

"param": {

`	`"normal\_record" : 1,

`	`"disconnect\_record" : 1,

`	`"alarm\_record": 1,

`	`"audio\_enable":1,

`	`"file\_len":5,

`	`"strategy" : 0,

`	`"face\_server\_enable": 1,

`	`"pre\_record":

`	 `{

`		`"enable":1

`		`"duration":10

`	 `}

}

}

}

参数说明：

<table><tr><th colspan="4" valign="top">参数</th><th colspan="1" valign="top">类型</th><th colspan="1" valign="top">说明</th><th colspan="1" valign="top">是否必须</th></tr>
<tr><td colspan="4" valign="top">msgid</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">消息ID，由设备生成，每条消息对应一个唯一的ID</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="4" valign="top">token</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">会话token，设备[connect](#连接服务器)服务器时，由服务器返回</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="4" valign="top">data</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" rowspan="11" valign="top"></td><td colspan="3" valign="top">uri</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">固定为"storage/record_set"</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="3" valign="top">param</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" rowspan="9" valign="top"></td><td colspan="2" valign="top">normal_record</td><td colspan="1" valign="top">布尔</td><td colspan="1" valign="top">手动录像</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">disconnect_record</td><td colspan="1" valign="top">布尔</td><td colspan="1" valign="top">断网录像</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">alarm_record</td><td colspan="1" valign="top">布尔</td><td colspan="1" valign="top">报警录像</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">audio_enable</td><td colspan="1" valign="top">布尔</td><td colspan="1" valign="top">是否录制音频</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">file_len</td><td colspan="1" valign="top">整形</td><td colspan="1" valign="top">录像时长 1-60min </td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">strategy</td><td colspan="1" valign="top">整形</td><td colspan="1" valign="top">0 -1 0是循环覆盖，1是录满停止</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">pre_record</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top">预录</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" rowspan="2" valign="top"></td><td colspan="1" valign="top">enable</td><td colspan="1" valign="top">布尔</td><td colspan="1" valign="top">开启预录</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">duration</td><td colspan="1" valign="top">时长</td><td colspan="1" valign="top">0-10s</td><td colspan="1" valign="top">是</td></tr>
</table>


响应

{

"msgid": "adfdgwrt245356",

"data": {

"uri"：" /storage/record\_set",

"code": 200,

"msg": "OK"

`	`}

}

参数说明：

<table><tr><th colspan="2" valign="top">参数</th><th colspan="1" valign="top">类型</th><th colspan="1" valign="top">说明</th><th colspan="1" valign="top">是否必须</th></tr>
<tr><td colspan="2" valign="top">msgid</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">消息ID，与命令中的参数一致。</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">data</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" rowspan="3" valign="top"></td><td colspan="1" valign="top">uri</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">固定为"storage/record_set"</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="1" valign="top">code</td><td colspan="1" valign="top">整型</td><td colspan="1" valign="top">错误码，详见错误码定义。</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">msg</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">执行结果描述。</td><td colspan="1" valign="top">否</td></tr>
</table>


### <a name="_toc9800"></a>**1.7 按月获取每天的视频文件数量** 
服务器按月获取每天的视频文件数量，

{

"msgid": "adfdgwrt245356",

"token"："adf4453456ghhjgsf23546y",

"data": {

"uri"："/storage/record\_by\_month",

"param": {

"year": 2021,

` `"month": 10

}

}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，由设备生成，每条消息对应一个唯一的ID</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">token</td><td valign="top">字符串</td><td valign="top">会话token，设备[connect](#连接服务器)服务器时，由服务器返回</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="4" valign="top"></td><td colspan="2" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"storage/record_by_month"</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">param</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="2" valign="top"></td><td valign="top">year</td><td valign="top">整型</td><td valign="top">年份，如2021</td><td valign="top">是</td></tr>
<tr><td valign="top">month</td><td valign="top">整型</td><td valign="top">月份，0表示一月，1表示二月，以此类推</td><td valign="top">是</td></tr>
</table>


响应

{

"msgid": "adfdgwrt245356",

"data": {

"uri": "/storage/record\_by\_month",

"code": 0,

"msg": "OK",

"result": [

{ "day": 1, "count": 138 },

{ "day": 2, "count": 95 },

{ "day": 3, "count": 12 }

],

`	`}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，与命令中的参数一致。</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="3" valign="top"></td><td colspan="2" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"storage/record_by_month"</td><td valign="top">否</td></tr>
<tr><td colspan="2" valign="top">code</td><td valign="top">整型</td><td valign="top">错误码，详见错误码定义。</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">msg</td><td valign="top">字符串</td><td valign="top">执行结果描述。</td><td valign="top">否</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top">result</td><td colspan="2" valign="top">对象</td><td colspan="2" valign="top"></td><td colspan="2" valign="top">否</td></tr>
<tr><td valign="top"></td><td rowspan="2" valign="top"></td><td valign="top">day</td><td valign="top">整型</td><td valign="top">日期，从1开始</td><td valign="top">是</td></tr>
<tr><td valign="top"></td><td valign="top">count</td><td valign="top">整型</td><td valign="top">对应日期的视频文件数量</td><td valign="top">是</td></tr>
</table>


### <a name="_toc28195"></a>**1.8 按月获取每天的视频文件数量**
服务器显示获取的视频文件信息，

{

"msgid": "adfdgwrt245356",

"token"："adf4453456ghhjgsf23546y",

"data": {

"uri"："/storage/get\_record\_list",

"param": {

"start\_time": "2021-10-03 10:30:00",

"end\_time": "2021-10-03 16:00:00",

"page\_num": 0,

"page\_size": 100

}

}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，由设备生成，每条消息对应一个唯一的ID</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">token</td><td valign="top">字符串</td><td valign="top">会话token，设备[connect](#连接服务器)服务器时，由服务器返回</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="6" valign="top"></td><td colspan="2" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"storage/get_record_list"</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">param</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="4" valign="top"></td><td valign="top">start_time</td><td valign="top">字符串</td><td valign="top">起始时间，格式为：yyyy-MM-dd HH:mm:ss</td><td valign="top">是</td></tr>
<tr><td valign="top">end_time</td><td valign="top">字符串</td><td valign="top">结束时间，格式为：yyyy-MM-dd HH:mm:ss</td><td valign="top">是</td></tr>
<tr><td valign="top">page_num</td><td valign="top">整型</td><td valign="top">页面，从0开始</td><td valign="top">是</td></tr>
<tr><td valign="top">page_size</td><td valign="top">整型</td><td valign="top">每页记录条数，最大不超过500</td><td valign="top">是</td></tr>
</table>


响应

{

"msgid": "adfdgwrt245356",

"data": {

"uri": "/storage/get\_record\_list",

"code": 0,

"msg": "OK",

"result": {

"total\_page":1,

"total\_file":68,

"page\_size":100,

"recordlist": [

{

"filename":"/progs/rec/00/20211003/N02180546.mp4",

"start\_time":"2021-10-03 10:05:46",

"end\_time":"2021-10-03 10:15:48",

},

...

]

}

`	`}

}

参数说明：

<table><tr><th colspan="4" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="4" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，与命令中的参数一致。</td><td valign="top">是</td></tr>
<tr><td colspan="4" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="4" valign="top"></td><td colspan="3" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"storage/get_record_list"</td><td valign="top">否</td></tr>
<tr><td colspan="3" valign="top">code</td><td valign="top">整型</td><td valign="top">错误码，详见错误码定义。</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">msg</td><td valign="top">字符串</td><td valign="top">执行结果描述。</td><td valign="top">否</td></tr>
<tr><td colspan="3" valign="top">result</td><td valign="top">对象</td><td valign="top"></td><td valign="top">否</td></tr>
<tr><td valign="top"></td><td rowspan="2" valign="top"></td><td colspan="2" valign="top">total_page</td><td valign="top">整型</td><td valign="top">该时间段包含的视频总页数</td><td valign="top">是</td></tr>
<tr><td valign="top"></td><td colspan="2" valign="top">total_file</td><td valign="top">整型</td><td valign="top">该时间段包含的视频数量</td><td valign="top">是</td></tr>
<tr><td valign="top"></td><td valign="top"></td><td colspan="2" valign="top">page_size</td><td valign="top">整型</td><td valign="top">每页记录条数，最大不超过500</td><td valign="top">是</td></tr>
<tr><td valign="top"></td><td valign="top"></td><td colspan="2" valign="top">recordlist</td><td valign="top">对象</td><td valign="top"></td><td valign="top">否</td></tr>
<tr><td valign="top"></td><td valign="top"></td><td rowspan="3" valign="top"></td><td valign="top">filename</td><td valign="top">字符串</td><td valign="top">视频文件的名称或路径</td><td valign="top">否</td></tr>
<tr><td valign="top"></td><td valign="top"></td><td valign="top">start_time</td><td valign="top">字符串</td><td valign="top">该文件开始录像的时间，格式为yyyy-MM-dd HH:mm:ss</td><td valign="top">否</td></tr>
<tr><td valign="top"></td><td valign="top"></td><td valign="top">end_time</td><td valign="top">字符串</td><td valign="top">停止录像的时间</td><td valign="top">否</td></tr>
</table>


### <a name="_toc11168"></a>**1.9 重启设备**
服务器重启设备，

{

"msgid": "adfdgwrt245356",

"token"："adf4453456ghhjgsf23546y",

"data": {

"uri"："/system/maintain/reboot",

"param": {

"delay\_ms": 1000

}

}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，由设备生成，每条消息对应一个唯一的ID</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">token</td><td valign="top">字符串</td><td valign="top">会话token，设备[connect](#连接服务器)服务器时，由服务器返回</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="3" valign="top"></td><td colspan="2" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"system/maintain/reboot"</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">param</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td valign="top"></td><td valign="top">delay_ms</td><td valign="top">整型</td><td valign="top">重启延时，单位：ms</td><td valign="top">是</td></tr>
</table>


响应

{

"msgid": "adfdgwrt245356",

"data": {

"uri": "/system/maintain/reboot",

"code": 0,

"msg": "OK",

}

}

参数说明：

<table><tr><th colspan="2" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="2" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，与命令中的参数一致。</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="3" valign="top"></td><td valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"system/maintain/reboot"</td><td valign="top">否</td></tr>
<tr><td valign="top">code</td><td valign="top">整型</td><td valign="top">错误码，详见错误码定义。</td><td valign="top">是</td></tr>
<tr><td valign="top">msg</td><td valign="top">字符串</td><td valign="top">执行结果描述。</td><td valign="top">否</td></tr>
</table>


### <a name="_toc30318"></a>**1.10 查询抓拍图像的文件列表**
服务器查询抓拍文件列表，

{

"msgid": "adfdgwrt245356",

"token"："adf4453456ghhjgsf23546y",

"data": {

"uri"："/ivp/face/get\_cap\_history",

"param": {

"start\_time": "2021-10-03 10:30:00",

"end\_time": "2021-10-03 16:00:00",

"page\_num": 1,

"page\_size": 32,

"name": "张三",

"workId":"10091",

"idCard":"xxxxxxxxxxxxxxxxxx",

"phone":"136xxxxxxxx"

}

}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，由设备生成，每条消息对应一个唯一的ID</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">token</td><td valign="top">字符串</td><td valign="top">会话token，设备[connect](#连接服务器)服务器时，由服务器返回</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="6" valign="top"></td><td colspan="2" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"ivp/face/get_cap_history"</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">param</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="3" valign="top"></td><td valign="top">start_time</td><td valign="top">字符串</td><td valign="top">起始时间，格式为：yyyy-MM-dd HH:mm:ss</td><td valign="top">是</td></tr>
<tr><td valign="top">end_time</td><td valign="top">字符串</td><td valign="top">结束时间，格式为：yyyy-MM-dd HH:mm:ss</td><td valign="top">是</td></tr>
<tr><td valign="top">page_num</td><td valign="top">整型</td><td valign="top">页面</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top">page_size</td><td colspan="2" valign="top">整型</td><td colspan="2" valign="top">每页记录条数，最大不超过32</td><td colspan="2" valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top"></td><td colspan="2" valign="top">name</td><td colspan="2" valign="top">字符串</td><td colspan="2" valign="top">指定姓名</td><td colspan="2" valign="top">否</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top"></td><td colspan="2" valign="top">workId</td><td colspan="2" valign="top">字符串</td><td colspan="2" valign="top">指定工号</td><td colspan="2" valign="top">否</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top"></td><td colspan="2" valign="top">idCard</td><td colspan="2" valign="top">字符串</td><td colspan="2" valign="top">指定身份证号</td><td colspan="2" valign="top">否</td></tr>
<tr><td valign="top"></td><td valign="top"></td><td valign="top">phone</td><td valign="top">字符串</td><td valign="top">指定手机号</td><td valign="top">否</td></tr>
</table>


响应

{

"msgid": "adfdgwrt245356",

"data": {

"uri": "/ivp/face/get\_cap\_history",

"code": 0,

"msg": "OK",

"result": {

"face\_total":916,

"face\_list": [

{

"name":"张三",

"similarity": 80,

"gender": 2,

"age": 27,

"time":"2022-09-24 14:27:41",

"jpeg\_url\_face":"sdcard/20210924/14/2741\_179.jpg",

"jpeg\_url\_body":"sdcard/20210924/14/2741\_179\_body.jpg",

"jpeg\_url\_frame":"sdcard/20220924/14/2741\_179\_bg.jpg",

},

...

]

}

}

}

参数说明：

<table><tr><th colspan="4" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="4" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，与命令中的参数一致。</td><td valign="top">是</td></tr>
<tr><td colspan="4" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="14" valign="top"></td><td colspan="3" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"ivp/face/get_cap_history"</td><td valign="top">否</td></tr>
<tr><td colspan="3" valign="top">code</td><td valign="top">整型</td><td valign="top">错误码，详见错误码定义。</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">msg</td><td valign="top">字符串</td><td valign="top">执行结果描述。</td><td valign="top">否</td></tr>
<tr><td colspan="3" valign="top">result</td><td valign="top">对象</td><td valign="top"></td><td valign="top">否</td></tr>
<tr><td rowspan="10" valign="top"></td><td colspan="2" valign="top">face_total</td><td valign="top">整型</td><td valign="top">该时间段包含的抓拍记录数量</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">face_list</td><td valign="top">数组</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="8" valign="top"></td><td valign="top">time</td><td valign="top">字符串</td><td valign="top">抓拍的时间点，格式为yyyy-MM-dd HH:mm:ss</td><td valign="top">是</td></tr>
<tr><td valign="top">jpeg_url_face</td><td valign="top">字符串</td><td valign="top">抓拍的人脸图片路径</td><td valign="top">否</td></tr>
<tr><td valign="top">jpeg_url_body</td><td valign="top">字符串</td><td valign="top">抓拍的人体全身图片路径</td><td valign="top">否</td></tr>
<tr><td valign="top">jpeg_url_frame</td><td valign="top">字符串</td><td valign="top">抓拍记录对应的全景图片路径</td><td valign="top">是</td></tr>
<tr><td valign="top">name</td><td valign="top">字符串</td><td valign="top">姓名</td><td valign="top">否</td></tr>
<tr><td valign="top">similarity</td><td valign="top">整型</td><td valign="top">相似度</td><td valign="top">否</td></tr>
<tr><td valign="top">gender</td><td valign="top">整型</td><td valign="top">性别，1-男 2-女</td><td valign="top">否</td></tr>
<tr><td valign="top">age</td><td valign="top">整型</td><td valign="top">年龄</td><td valign="top">否</td></tr>
</table>


### <a name="_toc1248"></a>**1.11 查询行人抓拍图像的文件列表**
服务器查询指定时间段的抓拍文件列表，

{

"msgid": "adfdgwrt245356",

"token"："adf4453456ghhjgsf23546y",

"data": {

"uri"："/person/get\_cap\_history",

"param": {

"start\_time": "2021-10-03 10:30:00",

"end\_time": "2021-10-03 16:00:00",

"page\_num": 0,

"page\_size": 32

}

}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，由设备生成，每条消息对应一个唯一的ID</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">token</td><td valign="top">字符串</td><td valign="top">会话token，设备[connect](#连接服务器)服务器时，由服务器返回</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="6" valign="top"></td><td colspan="2" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"person/get_cap_history"</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">param</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="4" valign="top"></td><td valign="top">start_time</td><td valign="top">字符串</td><td valign="top">起始时间，格式为：yyyy-MM-dd HH:mm:ss</td><td valign="top">是</td></tr>
<tr><td valign="top">end_time</td><td valign="top">字符串</td><td valign="top">结束时间，格式为：yyyy-MM-dd HH:mm:ss</td><td valign="top">是</td></tr>
<tr><td valign="top">page_num</td><td valign="top">整型</td><td valign="top">页面</td><td valign="top">是</td></tr>
<tr><td valign="top">page_size</td><td valign="top">整型</td><td valign="top">每页记录条数，最大不超过32</td><td valign="top">是</td></tr>
</table>


响应

{

"msgid": "adfdgwrt245356",

"data": {

"uri": "/person/get\_cap\_history",

"code": 0,

"msg": "OK",

"result": {

"total":916,

"list": [

{

"time":"2022-09-24 14:27:41",

"jpeg\_url\_face":"sdcard/20210924/14/2741\_179.jpg",

"jpeg\_url\_body":"sdcard/20210924/14/2741\_179\_body.jpg",

"jpeg\_url\_frame":"sdcard/20220924/14/2741\_179\_bg.jpg"

},

...

]

}

}

}

参数说明：

<table><tr><th colspan="4" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="4" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，与命令中的参数一致。</td><td valign="top">是</td></tr>
<tr><td colspan="4" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="10" valign="top"></td><td colspan="3" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"person/get_cap_history"</td><td valign="top">否</td></tr>
<tr><td colspan="3" valign="top">code</td><td valign="top">整型</td><td valign="top">错误码，详见错误码定义。</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">msg</td><td valign="top">字符串</td><td valign="top">执行结果描述。</td><td valign="top">否</td></tr>
<tr><td colspan="3" valign="top">result</td><td valign="top">对象</td><td valign="top"></td><td valign="top">否</td></tr>
<tr><td rowspan="6" valign="top"></td><td colspan="2" valign="top">total</td><td valign="top">整型</td><td valign="top">该时间段包含的抓拍记录数量</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">list</td><td valign="top">数组</td><td valign="top">抓拍数据</td><td valign="top">是</td></tr>
<tr><td rowspan="4" valign="top"></td><td valign="top">time</td><td valign="top">字符串</td><td valign="top">抓拍的时间点，格式为yyyy-MM-dd HH:mm:ss</td><td valign="top">是</td></tr>
<tr><td valign="top">jpeg_url_face</td><td valign="top">字符串</td><td valign="top">抓拍的人脸图片路径</td><td valign="top">否</td></tr>
<tr><td valign="top">jpeg_url_body</td><td valign="top">字符串</td><td valign="top">抓拍的人体全身图片路径</td><td valign="top">否</td></tr>
<tr><td valign="top">jpeg_url_frame</td><td valign="top">字符串</td><td valign="top">抓拍记录对应的全景图片路径</td><td valign="top">是</td></tr>
</table>


### <a name="_toc25316"></a>**1.12 下发人员信息及照片**
服务器查询指定时间段的抓拍文件列表，

{

"msgid": "adfdgwrt245356",

"token"："adf4453456ghhjgsf23546y",

"data": {

"uri"："/person/add",

"param": {

"pid": "123456",

"name": "姓名",

"work\_id": "工号",

"id\_card\_no": "身份证号码",

"ic\_card\_no": "RF卡号",

"gender": 1,

"age": 25,

"department": "部门名称",

"photo": "照片base64编码",

"category": 1

}

}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，由设备生成，每条消息对应一个唯一的ID</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">token</td><td valign="top">字符串</td><td valign="top">会话token，设备[connect](#连接服务器)服务器时，由服务器返回</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="6" valign="top"></td><td colspan="2" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"person/add"</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">param</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="3" valign="top"></td><td valign="top">pid</td><td valign="top">字符串</td><td valign="top">一般为整数形式的字符串，最大不超过2<sup>64</sup></td><td valign="top">是</td></tr>
<tr><td valign="top">name</td><td valign="top">字符串</td><td valign="top">姓名</td><td valign="top">是</td></tr>
<tr><td valign="top">work_id</td><td valign="top">字符串</td><td valign="top">工号</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top">id_card_no</td><td colspan="2" valign="top">字符串</td><td colspan="2" valign="top">身份证号码</td><td colspan="2" valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top"></td><td colspan="2" valign="top">ic_card_no</td><td colspan="2" valign="top">字符串</td><td colspan="2" valign="top">IC卡号码</td><td colspan="2" valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top"></td><td colspan="2" valign="top">gender</td><td colspan="2" valign="top">整型</td><td colspan="2" valign="top">性别，1-男 2-女</td><td colspan="2" valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top"></td><td colspan="2" valign="top">age</td><td colspan="2" valign="top">整型</td><td colspan="2" valign="top">年龄</td><td colspan="2" valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top"></td><td colspan="2" valign="top">department</td><td colspan="2" valign="top">字符串</td><td colspan="2" valign="top">部门名称</td><td colspan="2" valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top"></td><td colspan="2" valign="top">photo</td><td colspan="2" valign="top">字符串</td><td colspan="2" valign="top">人脸照片base64编码</td><td colspan="2" valign="top">是</td></tr>
<tr><td valign="top"></td><td valign="top"></td><td valign="top">category</td><td valign="top">整型</td><td valign="top">类别，1:白名单；2:黑名单；3:VIP；4:访客</td><td valign="top">是</td></tr>
</table>


响应

{

"msgid": "adfdgwrt245356",

"data": {

"uri": "/person/add",

"code": 0,

"msg": "OK",

}

}

参数说明：

<table><tr><th colspan="2" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="2" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，与命令中的参数一致。</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="2" valign="top"></td><td valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"person/add"</td><td valign="top">否</td></tr>
<tr><td valign="top">code</td><td valign="top">整型</td><td valign="top">错误码，详见错误码定义。</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top">msg</td><td colspan="2" valign="top">字符串</td><td colspan="2" valign="top">执行结果描述。</td><td colspan="2" valign="top">否</td></tr>
</table>


### <a name="_toc27388"></a>**1.13 查询人员列表**
服务器查询人员列表，

{

"msgid": "adfdgwrt245356",

"token"："adf4453456ghhjgsf23546y",

"data": {

"uri"："/person/list",

"param": {

"page\_num":1,

"page\_size":32,

"category":1,

"name":"张三",

"workId":"10091",

"idCard":"xxxxxxxxxxxxxxxxxx",

"phone":"136xxxxxxxx"

}

}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，由设备生成，每条消息对应一个唯一的ID</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">token</td><td valign="top">字符串</td><td valign="top">会话token，设备[connect](#连接服务器)服务器时，由服务器返回</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="2" valign="top"></td><td colspan="2" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"person/list"</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">param</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td colspan="2" rowspan="6" valign="top"></td><td colspan="2" valign="top"></td><td colspan="2" valign="top">name</td><td colspan="2" valign="top">字符串</td><td colspan="2" valign="top">姓名</td><td colspan="2" valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top">workId</td><td colspan="2" valign="top">字符串</td><td colspan="2" valign="top">工号</td><td colspan="2" valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top">idCard</td><td colspan="2" valign="top">字符串</td><td colspan="2" valign="top">身份证号</td><td colspan="2" valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top">phone</td><td colspan="2" valign="top">整型</td><td colspan="2" valign="top">手机号</td><td colspan="2" valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top">category</td><td colspan="2" valign="top">整型</td><td colspan="2" valign="top">类别，1:白名单；2:黑名单；3:VIP；4:访客</td><td colspan="2" valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top">page_num</td><td colspan="2" valign="top">整型</td><td colspan="2" valign="top">页面</td><td colspan="2" valign="top">是</td></tr>
<tr><td valign="top"></td><td valign="top"></td><td valign="top">page_size</td><td valign="top">整型</td><td valign="top">每页记录条数，最大不超过32</td><td valign="top">是</td></tr>
</table>


响应

{

"msgid": "adfdgwrt245356",

"data": {

"uri": "/person/list",

"code": 0,

"msg": "OK",

"result": {

"total": 916,

"list": [

{

"pid":"123456",

"name": "张三",

"work\_id": "123457089",

"id\_card\_no": "",

"ic\_card\_no": "",

"department": "测试部",

"photo": "data/facelib/19017.jpg",

"phone": "",

"gender": 2,

"age": 27,

"category": 1

},

...

]

}

}

}

参数说明：

<table><tr><th colspan="4" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="4" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，与命令中的参数一致。</td><td valign="top">是</td></tr>
<tr><td colspan="4" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="17" valign="top"></td><td colspan="3" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"person/list"</td><td valign="top">否</td></tr>
<tr><td colspan="3" valign="top">code</td><td valign="top">整型</td><td valign="top">错误码，详见错误码定义。</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">msg</td><td valign="top">字符串</td><td valign="top">执行结果描述。</td><td valign="top">否</td></tr>
<tr><td colspan="3" valign="top">result</td><td valign="top">对象</td><td valign="top"></td><td valign="top">否</td></tr>
<tr><td rowspan="13" valign="top"></td><td colspan="2" valign="top">total</td><td valign="top">整型</td><td valign="top">结果总数量</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">list</td><td valign="top">数组</td><td valign="top"></td><td valign="top">否</td></tr>
<tr><td rowspan="11" valign="top"></td><td valign="top">pid</td><td valign="top">字符串</td><td valign="top">一般为整数形式的字符串，最大不超过2<sup>64</sup></td><td valign="top">是</td></tr>
<tr><td valign="top">name</td><td valign="top">字符串</td><td valign="top">姓名</td><td valign="top">是</td></tr>
<tr><td valign="top">work_id</td><td valign="top">字符串</td><td valign="top">工号</td><td valign="top">是</td></tr>
<tr><td valign="top">id_card_no</td><td valign="top">字符串</td><td valign="top">身份证号</td><td valign="top">是</td></tr>
<tr><td valign="top">ic_card_no</td><td valign="top">字符串</td><td valign="top">IC卡号</td><td valign="top">是</td></tr>
<tr><td valign="top">department</td><td valign="top">字符串</td><td valign="top">部门</td><td valign="top">是</td></tr>
<tr><td valign="top">photo</td><td valign="top">字符串</td><td valign="top">图片路径</td><td valign="top">是</td></tr>
<tr><td valign="top">phone</td><td valign="top">字符串</td><td valign="top">手机号</td><td valign="top">是</td></tr>
<tr><td valign="top">gender</td><td valign="top">整型</td><td valign="top">性别，1-男 2-女</td><td valign="top">是</td></tr>
<tr><td valign="top">age</td><td valign="top">整型</td><td valign="top">年龄</td><td valign="top">是</td></tr>
<tr><td valign="top">category</td><td valign="top">整型</td><td valign="top">类别，1:白名单；2:黑名单；3:VIP；4:访客</td><td valign="top">是</td></tr>
</table>


### <a name="_toc29116"></a>**1.14 查询人员信息**
服务器查询人员信息，

{

"msgid": "adfdgwrt245356",

"token"："adf4453456ghhjgsf23546y",

"data": {

"uri"："/person/query",

"param": {

"pid": "123456"

}

}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，由设备生成，每条消息对应一个唯一的ID</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">token</td><td valign="top">字符串</td><td valign="top">会话token，设备[connect](#连接服务器)服务器时，由服务器返回</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="3" valign="top"></td><td colspan="2" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"person/query"</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">param</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td valign="top"></td><td valign="top">pid</td><td valign="top">字符串</td><td valign="top">一般为整数形式的字符串，最大不超过2<sup>64</sup></td><td valign="top">是</td></tr>
</table>


响应

{

"msgid": "adfdgwrt245356",

"data": {

"uri": "/person/query",

"code": 0,

"msg": "OK",

"result": {

"pid": "123456",

"name": "姓名",

"work\_id": "工号",

"id\_card\_no": "身份证号码",

"ic\_card\_no": "IC卡号",

"gender": 1,

"age": 25,

"department": "市场部",

"photo": "sdcard/20210924/14/2741\_179.jpg",

"category": "类别",

"phone": "136xxxxxxxx"

}

}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，与命令中的参数一致。</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="3" valign="top"></td><td colspan="2" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"person/query"</td><td valign="top">否</td></tr>
<tr><td colspan="2" valign="top">code</td><td valign="top">整型</td><td valign="top">错误码，详见错误码定义。</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">msg</td><td valign="top">字符串</td><td valign="top">执行结果描述。</td><td valign="top">否</td></tr>
<tr><td rowspan="12" valign="top"></td><td colspan="2" valign="top">result</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="11" valign="top"></td><td valign="top">pid</td><td valign="top">字符串</td><td valign="top">一般为整数形式的字符串，最大值不超过2<sup>64</sup>。</td><td valign="top">是</td></tr>
<tr><td valign="top">name</td><td valign="top">字符串</td><td valign="top">姓名</td><td valign="top">是</td></tr>
<tr><td valign="top">work_id</td><td valign="top">字符串</td><td valign="top">工号</td><td valign="top">是</td></tr>
<tr><td valign="top">id_card_no</td><td valign="top">字符串</td><td valign="top">身份证号码</td><td valign="top">是</td></tr>
<tr><td valign="top">ic_card_no</td><td valign="top">字符串</td><td valign="top">IC卡号码</td><td valign="top">是</td></tr>
<tr><td valign="top">gender</td><td valign="top">整型</td><td valign="top">性别，1-男 2-女</td><td valign="top">是</td></tr>
<tr><td valign="top">age</td><td valign="top">整型</td><td valign="top">年龄</td><td valign="top">是</td></tr>
<tr><td valign="top">department</td><td valign="top">字符串</td><td valign="top">部门名称</td><td valign="top">是</td></tr>
<tr><td valign="top">photo</td><td valign="top">字符串</td><td valign="top">人脸照片路径或ID，可通过"读取文件(抓拍图片)内容"接口获取图片内容。</td><td valign="top">是</td></tr>
<tr><td valign="top">category</td><td valign="top">整型</td><td valign="top">类别，1:白名单；2:黑名单；3:VIP；4:访客</td><td valign="top">是</td></tr>
<tr><td valign="top">phone</td><td valign="top">字符串</td><td valign="top">手机号</td><td valign="top">是</td></tr>
</table>


### <a name="_toc12307"></a>**1.15 删除人员信息**
服务器删除人员信息，

{

"msgid": "adfdgwrt245356",

"token"："adf4453456ghhjgsf23546y",

"data": {

"uri"："/person/delete",

"param": {

"pid": "123456"

}

}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，由设备生成，每条消息对应一个唯一的ID</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">token</td><td valign="top">字符串</td><td valign="top">会话token，设备[connect](#连接服务器)服务器时，由服务器返回</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="3" valign="top"></td><td colspan="2" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"person/delete"</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">param</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td valign="top"></td><td valign="top">pid</td><td valign="top">字符串</td><td valign="top">一般为整数形式的字符串，最大不超过2<sup>64</sup></td><td valign="top">否</td></tr>
</table>


响应

{

"msgid": "adfdgwrt245356",

"data": {

"uri": "/person/delete",

"code": 0,

"msg": "OK",

}

}

参数说明：

<table><tr><th colspan="2" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="2" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，与命令中的参数一致。</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="2" valign="top"></td><td valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"person/delete"</td><td valign="top">否</td></tr>
<tr><td valign="top">code</td><td valign="top">整型</td><td valign="top">错误码，详见错误码定义。</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top">msg</td><td colspan="2" valign="top">字符串</td><td colspan="2" valign="top">执行结果描述。</td><td colspan="2" valign="top">否</td></tr>
</table>


### <a name="_toc11833"></a>**1.16 以图搜图**
服务器以图搜图，

{

"msgid": "adfdgwrt245356",

"token"："adf4453456ghhjgsf23546y",

"data": {

"uri"："/person/search",

"param": {

"photo": "base64",

"threshold": 80,

"start\_time": "2021-10-03 10:30:00",

"end\_time": "2021-10-03 16:00:00"

}

}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，由设备生成，每条消息对应一个唯一的ID</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">token</td><td valign="top">字符串</td><td valign="top">会话token，设备[connect](#连接服务器)服务器时，由服务器返回</td><td valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="3" valign="top"></td><td colspan="2" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"person/search"</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">param</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="4" valign="top"></td><td valign="top">photo</td><td valign="top">字符串</td><td valign="top">图片的base64编码</td><td valign="top">否</td></tr>
<tr><td valign="top"></td><td valign="top">threshold</td><td valign="top">整型</td><td valign="top">比对阈值，有效值为0 - 100</td><td valign="top">是</td></tr>
<tr><td valign="top"></td><td valign="top">start_time</td><td valign="top">字符串</td><td valign="top">起始时间，格式为：yyyy-MM-dd HH:mm:ss</td><td valign="top">是</td></tr>
<tr><td valign="top"></td><td valign="top">end_time</td><td valign="top">字符串</td><td valign="top">结束时间，格式为：yyyy-MM-dd HH:mm:ss</td><td valign="top">是</td></tr>
</table>


响应

{

"msgid": "adfdgwrt245356",

"data": {

"uri": "/person/search",

"code": 0,

"msg": "OK",

"result": {

"total": 16,

"face\_list": [

{

"time":"2022-09-24 14:27:41",

"score": 90,

"jpeg\_url\_face":"sdcard/20210924/14/2741\_179.jpg",

},

]

}

}

}

参数说明：

<table><tr><th colspan="4" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="4" valign="top">msgid</td><td valign="top">字符串</td><td valign="top">消息ID，与命令中的参数一致。</td><td valign="top">是</td></tr>
<tr><td colspan="4" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">是</td></tr>
<tr><td rowspan="2" valign="top"></td><td colspan="3" valign="top">uri</td><td valign="top">字符串</td><td valign="top">固定为"person/search"</td><td valign="top">否</td></tr>
<tr><td colspan="3" valign="top">code</td><td valign="top">整型</td><td valign="top">错误码，详见错误码定义。</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="8" valign="top">msg</td><td colspan="2" valign="top">字符串</td><td colspan="2" valign="top">执行结果描述。</td><td colspan="2" valign="top">否</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="8" valign="top">result</td><td colspan="2" valign="top">对象</td><td colspan="2" valign="top"></td><td colspan="2" valign="top">否</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="5" valign="top"></td><td colspan="3" valign="top">total</td><td colspan="2" valign="top">整型</td><td colspan="2" valign="top"></td><td colspan="2" valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top"></td><td colspan="6" valign="top">face_list</td><td colspan="2" valign="top">数组</td><td colspan="2" valign="top"></td><td colspan="2" valign="top">否</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top"></td><td colspan="4" valign="top"></td><td colspan="2" valign="top">time</td><td colspan="2" valign="top">字符串</td><td colspan="2" valign="top">图片时间</td><td colspan="2" valign="top">是</td></tr>
<tr><td colspan="2" valign="top"></td><td colspan="2" valign="top"></td><td colspan="2" valign="top"></td><td colspan="4" valign="top">score</td><td colspan="2" valign="top">整型</td><td colspan="2" valign="top">相似度分数</td><td colspan="2" valign="top">是</td></tr>
<tr><td valign="top"></td><td valign="top"></td><td valign="top"></td><td valign="top">jpeg_url_face</td><td valign="top">字符串</td><td valign="top">抓拍的人脸图片路径</td><td valign="top">是</td></tr>
</table>




## <a name="_toc13688"></a>**二、HTTP接口**
设备可通过服务器提供的HTTP接口查询和提交信息。生产环境与测试环境均使用HTTPS连接方式，在传输层进行数据加密。正常情况下，调用HTTP接口前应先调用[connect](#连接服务器)接口获取token，并在header中携带token，形式如下：

Content-Type: application/json

Authorization: Bearer <token><sup>[^1]</sup>

如果没有传递token或者token无效，接口将返回401错误。
### <a name="_toc21265"></a>**2.1 上传人脸抓拍图像**
POST /api/v1/adapter/lenfocus/face/capture

参数

{

"did"："1234512",

"time"： 1666781577,

"age"： 95, /\*比对机专用\*/

"gender"： 1, /\*比对机专用\*/

"uuid"： “1234566”, /\*比对机专用\*/

` `"name"： “1234566”, /\*比对机专用\*/

"data"：{

"face\_data"："data:image/jpeg;base64,UklGRuAb…AABXRAAA==",

"body\_data"："data:image/jpeg;base64,UklGRuAb…AABXRAAA==",

"bg\_data"："data:image/jpeg;base64,UklGRuAb…AABXRAAA=="

}

}

参数说明：

<table><tr><th colspan="2" valign="top">参数</th><th valign="top">类型</th><th valign="top">说明</th><th valign="top">是否必须</th></tr>
<tr><td colspan="2" valign="top">did</td><td valign="top">字符串</td><td valign="top">设备id</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">time</td><td valign="top">整数</td><td valign="top">抓拍时间，UNIX时间戳，单位：秒</td><td valign="top">是</td></tr>
<tr><td colspan="2" valign="top">name</td><td valign="top">字符串</td><td valign="top">姓名</td><td valign="top">比对机</td></tr>
<tr><td colspan="2" valign="top">age</td><td valign="top">整数</td><td valign="top">年龄</td><td valign="top">比对机</td></tr>
<tr><td colspan="2" valign="top">gender</td><td valign="top">整数</td><td valign="top">1-男，2-女</td><td valign="top">比对机</td></tr>
<tr><td colspan="2" valign="top">uuid</td><td valign="top">字符串</td><td valign="top">人脸id</td><td valign="top">比对机</td></tr>
<tr><td colspan="2" valign="top">data</td><td valign="top">对象</td><td valign="top"></td><td valign="top">否</td></tr>
<tr><td rowspan="3" valign="top"></td><td valign="top">face_data</td><td valign="top">字符串</td><td valign="top">人脸图,base64编码</td><td valign="top">否</td></tr>
<tr><td valign="top">body_data</td><td valign="top">字符串</td><td valign="top">全身照,base64编码</td><td valign="top">否</td></tr>
<tr><td valign="top">bg_data</td><td valign="top">字符串</td><td valign="top">全景图,base64编码</td><td valign="top">否</td></tr>
</table>



响应

{

"code":  错误码，

"msg": "返回消息"

}

参数说明：

|参数|类型|说明|是否必须|
| :-: | :-: | :-: | :-: |
|code|整数|错误码，详见错误码定义。|是|
|msg|字符串|执行结果描述。|否|



### <a name="_toc30454"></a>**2.2 上报设备信息(设备上电时调用)**
POST /api/v1/device/report/info

参数

{

"did"："1234512",

`	`"fwVer"："V1.0",

`	`"swVer"："V1.0",

"osVer"："V1.0",

"hwVer"："V1.0",

"devName"： "NFY-01"

}

参数说明：

|参数|类型|说明|是否必须|
| :-: | :-: | :-: | :-: |
|did|字符串|设备id|是|
|fwVer|字符串|固件版本|否|
|swVer|字符串|软件版本|否|
|osVer|字符串|系统版本|否|
|hwVer|字符串|硬件版本|否|
|devName|字符串|设备名称|否|



响应

{

`	`"code"：编码，

`	`"msg": 响应信息

}

参数说明：

|参数|类型|说明|是否必须|
| :-: | :-: | :-: | :-: |
|code|整数|错误码，详见错误码定义。|是|
|msg|字符串|执行结果描述。|否|


### <a name="_toc4397"></a>**2.3 查询在线升级版本信息**
POST /api/v1/ota/query

参数

{

"otaId": "35646hgf56768",

"sn": "Y3C122AP1234512",

"did"："1234512",

"fwVer"："1.2",

"swVer"："1.3",

"osVer"："1.4",

"hwVer"："1.5"

}

参数说明：

|参数|类型|说明|是否必须|
| :-: | :-: | :-: | :-: |
|otaId|字符串|在线升级查询代号，参见"下发设备参数"说明|是|
|sn|字符串|sn编码|否|
|did|字符串|设备ID|否|
|fwVer|字符串|固件版本|否|
|swVer|字符串|软件版本|否|
|osVer|字符串|系统版本|否|
|hwVer|字符串|硬件版本|否|



响应

{

"code"：编码，

`	`"msg": 响应消息，

`	`"data": {

`		`"verCode"： 453523,

`		`"verName"："v1.0",

`		`"description"："更新了一些问题",

`		`"releaseDate"："2021-01-01 08:00:00",

`		`"componentList"：[

{

`			   `"name"："Firmware",

`			   `"type"：1,

`			   `"size"：1024,

`			   `"md5"："ee1101953363bf8a57334d60251ca53e",

`			   `"sha256"："5e497a333048ae62e5701ff667edd6ba7...",

`			   `"url"："https://mi-test530.lenfocus.com/.../09b5c0e.bin"

}

]

}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th colspan="1" valign="top">类型</th><th colspan="1" valign="top">说明</th><th colspan="1" valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">code</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">错误码，详见错误码定义。</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="3" valign="top">msg</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">执行结果描述。</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="3" valign="top">data</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top">执行成功后返回的数据，失败时该字段为空。</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="1" rowspan="11" valign="top"></td><td colspan="2" valign="top">verCode</td><td colspan="1" valign="top">整数</td><td colspan="1" valign="top">版本号，整数形式，用于版本比较</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">verName</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">版本号，字符串形式，用于界面显示</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">description</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">版本更新说明</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="2" valign="top">releaseDate</td><td colspan="1" valign="top">日期</td><td colspan="1" valign="top">发布日期</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="2" valign="top">componentList</td><td colspan="1" valign="top">数组</td><td colspan="1" valign="top"></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" rowspan="6" valign="top"></td><td colspan="1" valign="top">name</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">组件名称</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">type</td><td colspan="1" valign="top">整数</td><td colspan="1" valign="top"><p>文件类型</p><p>1：描述文件</p><p>2：固件</p><p>3：App</p><p>4：模型文件</p><p>5：License</p></td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">size</td><td colspan="1" valign="top">整数</td><td colspan="1" valign="top">组件大小，单位：字节</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">md5</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">组件MD5值，小写字母</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">sha256</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">组件SHA256哈希值，小写字母</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="1" valign="top">url</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">组件下载链接</td><td colspan="1" valign="top">是</td></tr>
</table>


### <a name="_toc32008"></a>**2.4 上报告警信息**
POST /api/v1/device/report/event

参数

{

`	`"did"："1234512",

`	`"type"： 1,

"time"： 1666781577816,

"data"： {

"face\_data"："data:image/jpeg;base64,UklGRuAb…AABXRAAA==",

"body\_data"："data:image/jpeg;base64,UklGRuAb…AABXRAAA==",

"bg\_data"："data:image/jpeg;base64,UklGRuAb…AABXRAAA=="

"jpeg\_url\_face":"sdcard/20210924/14/2741\_179.jpg",

"jpeg\_url\_body":"sdcard/20210924/14/2741\_179\_body.jpg",

"jpeg\_url\_frame":"sdcard/20220924/14/2741\_179\_bg.jpg"

}

}

参数说明：

|参数|类型|说明|是否必须|
| :-: | :-: | :-: | :-: |
|did|字符串|设备id|是|
|type|整数|<p>事件类型:</p><p>1：移动侦测报警</p><p>2：智能分析报警:区域入侵或绊线检测报警</p><p>3：智能分析报警:视频遮挡报警</p><p>4：智能分析报警:婴儿啼哭报警</p><p>5：智能分析报警:人员聚集检测报警</p><p>6：智能分析报警:人员徘徊检测报警</p><p>7：智能分析报警:快速移动报警</p><p>8：火焰报警</p><p>9：智能分析报警:音量陡升报警</p><p>10：智能分析报警:环境噪声陡降报警</p><p>11：人形检测实时抓拍</p><p>12：关注人员(黑白名单)检测</p><p>13：离岗检测报警</p><p>14：体温检测报警</p>|是|
|time|整数|事件发生时间，UNIX时间戳，单位：毫秒|是|
|data|对象|事件参数，根据事件类型具体定义|否|


响应

{

"code"：错误编码

`	`"msg": 响应信息

}

参数说明：

|参数|类型|说明|是否必须|
| :-: | :-: | :-: | :-: |
|code|整数|错误码，详见错误码定义。|是|
|msg|字符串|执行结果描述。|否|


### <a name="_toc25958"></a>**2.5 上报车辆抓拍信息**
POST /api/v1/vehicle/capture

参数

{

`    `"did": "134",

`    `"sn": "Y3CA9PGDTKM7R1C",

`    `"time": "1673420964575",

`    `"data": {

`        `"full\_image": "全景图片",

`        `"vehicle\_loc": {

`            `"x": 1,

`            `"y": 2,

`            `"w": 3,

`            `"h": 4

`        `},

`        `"vehicle\_pic": "车身图片",

`        `"type": "1",

`        `"brand": "保时捷",

`        `"plate": {

`            `"id": "粤B54896",

`            `"plate\_loc": {

`                `"x": 2,

`                `"y": 3,

`                `"w": 4,

`                `"h": 50

`            `},

`            `"plate\_pic": "车牌图片",

`            `"plate\_type": 1

`        `}

`    `}

}

参数说明：

<table><tr><th colspan="3" valign="top">参数</th><th colspan="1" valign="top">类型</th><th colspan="1" valign="top">说明</th><th colspan="1" valign="top">是否必须</th></tr>
<tr><td colspan="3" valign="top">did</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">设备id</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="3" valign="top">sn</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">设备序列号</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="3" valign="top">time</td><td colspan="1" valign="top">整数</td><td colspan="1" valign="top">事件发生时间，UNIX时间戳，单位：毫秒</td><td colspan="1" valign="top">是</td></tr>
<tr><td colspan="3" valign="top">data</td><td colspan="1" valign="top">对象</td><td colspan="1" valign="top">事件参数，根据事件类型具体定义</td><td colspan="1" valign="top">否</td></tr>
<tr><td colspan="1" rowspan="10" valign="top"></td><td colspan="2" valign="top">full_image</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">抓拍全景图片，base64编码后的数据</td><td colspan="1" valign="top"></td></tr>
<tr><td colspan="2" valign="top">vehicle_loc</td><td colspan="1" valign="top">RECT</td><td colspan="1" valign="top">车辆在全景图片中的位置</td><td colspan="1" valign="top"></td></tr>
<tr><td colspan="2" valign="top">vehicle_pic</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">车身图片，base64编码后的数据</td><td colspan="1" valign="top"></td></tr>
<tr><td colspan="2" valign="top">type</td><td colspan="1" valign="top">整数</td><td colspan="1" valign="top"><p>车辆类型</p><p>0:  未知</p><p>1:  轿车</p><p>2:  货车</p><p>3:  面包车</p><p>4:  客车</p><p>5:  小货车</p><p>6:  SUV</p><p>7:  中型客车</p><p>8:  摩托车</p><p>9:  行人</p><p>10:  校车</p><p>11:  泥头车-渣土车</p><p>12:  高危车</p><p>13:  骑行人</p><p>15:  微型轿车</p><p>16:  小型轿车</p><p>17:  紧凑型轿车</p><p>18:  两厢轿车</p><p>19:  三厢轿车</p><p>20:  轻客</p><p>21:  小型SUV</p><p>22:  紧凑型SUV</p><p>23:  中型SUV</p><p>24:  中大型SUV</p><p>25:  大型SUV</p><p>26:  微型面包车</p><p>27:  MPV</p><p>28:  轿跑</p><p>29:  微卡</p><p>30:  皮卡</p><p>31:  中卡</p><p>32:  轻卡</p><p>33:  重卡</p><p>34:  出租车</p><p>35:  油罐车</p><p>36:  吊车</p></td><td colspan="1" valign="top"></td></tr>
<tr><td colspan="2" valign="top">brand</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">车辆品牌</td><td colspan="1" valign="top"></td></tr>
<tr><td colspan="2" valign="top">plate</td><td colspan="1" valign="top"></td><td colspan="1" valign="top"></td><td colspan="1" valign="top"></td></tr>
<tr><td colspan="1" valign="top"></td><td colspan="1" valign="top">id</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">车牌号码</td><td colspan="1" valign="top"></td></tr>
<tr><td colspan="1" valign="top"></td><td colspan="1" valign="top">plate_loc</td><td colspan="1" valign="top">RECT</td><td colspan="1" valign="top">车牌在全景图片中的位置</td><td colspan="1" valign="top"></td></tr>
<tr><td colspan="1" valign="top"></td><td colspan="1" valign="top">plate_pic</td><td colspan="1" valign="top">字符串</td><td colspan="1" valign="top">车牌图片，base64编码后的数据</td><td colspan="1" valign="top"></td></tr>
<tr><td colspan="1" valign="top"></td><td colspan="1" valign="top">plate_type</td><td colspan="1" valign="top">整数</td><td colspan="1" valign="top"><p>车牌类型</p><p>0,  未知类型</p><p>1,  普通蓝牌</p><p>2,  普通黑牌</p><p>3,  普通单层黄牌</p><p>4,  双层黄牌</p><p>5,  白色警牌</p><p>6,  白色武警</p><p>7,  双层白色武警</p><p>8,  单层军牌</p><p>9,  双层军牌</p><p>10, 领使馆牌</p><p>11, 港牌</p><p>13, 澳门牌</p><p>14, 农用车牌 拖拉机</p><p>15, 厂内牌</p><p>16, 个性化车牌</p><p>17, 新能源牌</p><p>18, 其他类型</p></td><td colspan="1" valign="top"></td></tr>
</table>

响应

{

"code"：错误编码

"msg": 响应信息

}


## <a name="_toc22059"></a>**三、签名算法**
将所有参数按key的字母升序排列，并移除其中value为空(无有效字符)的字段。

将排列后所有key和value的值拼接成一个字符串，然后在字符串末尾加上预先获取的secret值。

计算上述字符串的MD5值，并转换成16进制大写字符串。

示例：

设secret为"AABBCC112233"，现有如下的参数需要计算签名：

{

"sn": "Y3CA123489",

"did": "876433",

"ts": 1658029108,

"appid": "FUN790386"

}

按照上述规则，排序后的参数组合为：

"appid": "FUN790386"; "did": 876433; "sn": "Y3CA123489"; "ts": 1658029108;

将value拼接成一个字符串后，值为： 

appidFUN790386did876433snY3CA123489ts1658029108。

在其末尾加上secret后，最终的字符串为： 

appidFUN790386did876433snY3CA123489ts1658029108AABBCC112233。

此时计算该字符串的MD5为：

C7C164B353F05DF3E219E82FC4619912

该值即为最终的签名值。
## <a name="_toc15658"></a>**四、错误码**
200：成功

401：没有访问权限，需要进行身份认证

404：访问的路径不存在

420：参数异常

421：设备未注册

422：无效的AppId

423：签名校验错误

424：事件类型异常

425：客户端版本过低

426：请求的资源不存在


# <a name="_toc30584"></a>**附录**
一、设备端恢复出厂设置

长按Reset按钮恢复出厂设置之后，清除以下数据：

1\. 用户通过Web和APP设置的参数，如：WiFi配置、设备名称、用户名及登录密码、OSD、音视频参数、服务器配置、人脸抓拍参数等；

2\. Flash上存储的数据，如：抓拍图像、视频、日志等；

3\. 通过服务器下发的其它参数，如：设备绑定关系等。

保留以下数据：

1\. 设备信息数据，如：SN、MAC、安全码、根密钥等；

2\. P2P连接参数。

[^1]: <a name="_ref264892555"></a> 参考：<https://jwt.io/introduction/>